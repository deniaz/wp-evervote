(function(e,t){function n(e){this.identifier=e.postID;this.everVote=e.everVote}function r(t){var r=this;this.button=t.button;this.countElement=t.count;if(e(this.button).length>0){this.storage=new n({postID:e(this.button).attr("data-post-id"),everVote:r});if(!this.storage.hasVoted()){this.addListeners()}}}n.prototype.registerClient=function(){this.allocateLocalStorage();this.allocateSessionStorage();this.allocateCookie();this.allocateDB()};n.prototype.getObfuscatedKey=function(){var e="evervoted-client-"+this.identifier;return md5(e)};n.prototype.allocateLocalStorage=function(){if(typeof n!=="undefined"){window.localStorage.setItem(this.getObfuscatedKey(),true)}else{}};n.prototype.allocateSessionStorage=function(){if(typeof n!=="undefined"){window.sessionStorage.setItem(this.getObfuscatedKey(),true)}else{}};n.prototype.allocateCookie=function(){document.cookie="__ev_"+this.getObfuscatedKey()+"=true"};n.prototype.allocateDB=function(){if(typeof window.openDatabase!=="undefined"){this.db=openDatabase("evdb","1.0","EverVote Local DB",2*1024*1024);var e=this.identifier;this.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS evervotes (wp_post_id)");t.executeSql("INSERT INTO evervotes (wp_post_id) VALUES (?)",[e])})}};n.prototype.checkLocalStorage=function(){if(typeof n!=="undefined"){var e=window.localStorage.getItem(this.getObfuscatedKey());if(e!==null){return true}}return false};n.prototype.checkSessionStorage=function(){if(typeof n!=="undefined"){var e=window.sessionStorage.getItem(this.getObfuscatedKey());if(e!==null){return true}}return false};n.prototype.checkCookie=function(){var e="__ev_"+this.getObfuscatedKey();if(document.cookie.indexOf(e)>=0){return true}return false};n.prototype.checkDB=function(){if(typeof window.openDatabase!=="undefined"){this.db=openDatabase("evdb","1.0","EverVote Local DB",2*1024*1024);this.db.transaction(function(e){e.executeSql("SELECT * FROM evervotes",[],function(e,t){var n=t.rows.length,r;for(r=0;r<n;r++){if(t.item(r).wp_post_id===this.identifier){this.everVote.initAjax();break}}})})}else{this.everVote.initAjax()}};n.prototype.hasVoted=function(){if(this.checkLocalStorage()){return true}else if(this.checkSessionStorage()){return true}else if(this.checkCookie()){return true}return false};r.prototype.addListeners=function(){var t=this;e(this.button).removeAttr("disabled");e(this.button).live("click",{scope:t},t.createAjaxRequest)};r.prototype.initAjax=function(){var r=this;e.ajax({type:"POST",url:t.ajaxUrl,data:{action:"evervote",postID:this.button.attr("data-post-id"),everVoteNonce:t.everVoteNonce},success:function(t,i,s){e(r.countElement).text(t.votes);e(r.button).attr("disabled","disabled");var o=new n({postID:t.postID});o.registerClient()},error:function(e,t,n){}})};r.prototype.createAjaxRequest=function(t){var n=t.data.scope,r=e(this);n.initAjax()};e(document).ready(function(){if(e("#evervote-btn").length>0){var t=new r({button:e("#evervote-btn"),count:e("#evervote-count")})}})})(jQuery,EverVoteConfig)