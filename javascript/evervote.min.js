(function(e,t){function r(e){n.log("-- Init Storage");this.identifier=e.postID}function i(t){n.log("-- Hi from EverVote!");this.button=t.button;this.countElement=t.count;if(e(this.button).length>0){var i=new r({postID:e(this.button).attr("id")});if(!i.hasVoted()){this.addListeners()}}}var n={isEnabled:true,log:function(e){if(this.isEnabled&&window.console!=null){console.log(e)}}};r.prototype.registerClient=function(){this.allocateLocalStorage();this.allocateSessionStorage();this.allocateCookie();this.allocateDB()};r.prototype.getObfuscatedKey=function(){n.log("-- Obfuscated Key.");var e="evervoted-client-"+this.identifier;return md5(e)};r.prototype.allocateLocalStorage=function(){if(typeof r!=="undefined"){window.localStorage.setItem(this.getObfuscatedKey(),true);n.log("-- Added EverVote to LocalStorage")}else{n.log("-- Browser does not support localStorage.")}};r.prototype.allocateSessionStorage=function(){if(typeof r!=="undefined"){window.sessionStorage.setItem(this.getObfuscatedKey(),true);n.log("-- Added EverVote to SessionStorage")}else{n.log("-- Browser does not support sessionStorage.")}};r.prototype.allocateCookie=function(){document.cookie="__ev_"+this.getObfuscatedKey()+"=true";n.log("-- Added EverVote to Cookie.")};r.prototype.allocateDB=function(){if(typeof window.openDatabase!=="undefined"){n.log("-- Opening DB");this.db=openDatabase("evdb","1.0","EverVote Local DB",2*1024*1024);var e=this.identifier;console.log("HOI RÃ–BI: "+e);this.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS evervotes (wp_post_id)");t.executeSql("INSERT INTO evervotes (wp_post_id) VALUES (?)",[e])})}};r.prototype.checkLocalStorage=function(){if(typeof r!=="undefined"){n.log("-- Checking localStorage");var e=window.localStorage.getItem(this.getObfuscatedKey());if(e!==null){return true}}return false};r.prototype.checkSessionStorage=function(){if(typeof r!=="undefined"){n.log("-- Checking sessionStorage");var e=window.sessionStorage.getItem(this.getObfuscatedKey());if(e!==null){return true}}return false};r.prototype.checkCookie=function(){n.log("-- Checking Cookie");var e="__ev_"+this.getObfuscatedKey();if(document.cookie.indexOf(e)>=0){return true}return false};r.prototype.checkDB=function(){if(typeof window.openDatabase!=="undefined"){n.log("-- Checking DB");this.db=openDatabase("evdb","1.0","EverVote Local DB",2*1024*1024);this.db.transaction(function(e){e.executeSql("SELECT * FROM evervotes",[],function(e,t){var n=t.rows.length,r;for(r=0;r<n;r++){console.log(t.rows.item(0))}})})}return false};r.prototype.hasVoted=function(){if(this.checkLocalStorage()){return true}else if(this.checkSessionStorage()){return true}else if(this.checkCookie()){return true}else if(this.checkDB()){return true}return false};i.prototype.addListeners=function(){var t=this;e(this.button).removeAttr("disabled");e(this.button).live("click",{scope:t},t.createAjaxRequest)};i.prototype.createAjaxRequest=function(i){var s=i.data.scope,o=e(this);n.log("-- EverVote Button was clicked");e.ajax({type:"POST",url:t.ajaxUrl,data:{action:"evervote",postID:o.attr("data-post-id"),everVoteNonce:t.everVoteNonce},success:function(t,i,o){e(s.countElement).text(t.votes);e(s.button).attr("disabled","disabled");n.log("-- AJAX Call succeeded");var u=new r({postID:t.postID});u.registerClient()},error:function(e,t,r){n.log("-- AJAX Call failed.");n.log("--- Status: "+t);n.log("--- Error: "+r);n.log("-- Response: "+e.responseText)}})};e(document).ready(function(){if(e("#evervote-btn").length>0){var t=new i({button:e("#evervote-btn"),count:e("#evervote-count")})}})})(jQuery,EverVoteConfig)